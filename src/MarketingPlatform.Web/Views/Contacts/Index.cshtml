@{
    ViewData["Title"] = "Contacts";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-person-lines-fill"></i> Contacts</h2>
        <div>
            <a href="@Url.Action("Create", "Contacts")" class="btn btn-primary">
                <i class="bi bi-person-plus"></i> Add Contact
            </a>
            <button class="btn btn-success" onclick="importContacts()">
                <i class="bi bi-upload"></i> Import
            </button>
            <button class="btn btn-outline-secondary" onclick="exportContacts()">
                <i class="bi bi-download"></i> Export
            </button>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="row">
                <div class="col-md-6">
                    <input type="text" class="form-control" id="searchInput" placeholder="Search contacts...">
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="groupFilter">
                        <option value="">All Groups</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="unsubscribed">Unsubscribed</option>
                        <option value="bounced">Bounced</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div id="contacts-list">
                <div class="text-center py-5">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const apiBaseUrl = '@ViewBag.ApiBaseUrl';
        
        document.addEventListener('DOMContentLoaded', function() {
            loadContacts();
        });

        async function loadContacts() {
            const listContainer = document.getElementById('contacts-list');
            
            try {
                const mockContacts = [
                    { id: 1, firstName: 'Alice', lastName: 'Johnson', email: 'alice@example.com', phoneNumber: '+1-555-0101', status: 'Active', groups: ['Customers', 'Newsletter'] },
                    { id: 2, firstName: 'Bob', lastName: 'Smith', email: 'bob@example.com', phoneNumber: '+1-555-0102', status: 'Active', groups: ['Customers'] },
                    { id: 3, firstName: 'Carol', lastName: 'Williams', email: 'carol@example.com', phoneNumber: '+1-555-0103', status: 'Unsubscribed', groups: [] }
                ];
                
                renderContacts(mockContacts);
            } catch (error) {
                listContainer.innerHTML = `<div class="alert alert-danger">Error loading contacts: ${error.message}</div>`;
            }
        }

        function renderContacts(contacts) {
            const listContainer = document.getElementById('contacts-list');
            
            if (!contacts || contacts.length === 0) {
                listContainer.innerHTML = '<div class="alert alert-info"><i class="bi bi-info-circle"></i> No contacts found.</div>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table table-hover">';
            html += '<thead><tr><th><input type="checkbox" id="selectAll"></th><th>Name</th><th>Email</th><th>Phone</th><th>Groups</th><th>Status</th><th>Actions</th></tr></thead><tbody>';

            contacts.forEach(contact => {
                html += '<tr>';
                html += `<td><input type="checkbox" class="contact-checkbox" value="${contact.id}"></td>`;
                html += `<td><strong>${contact.firstName} ${contact.lastName}</strong></td>`;
                html += `<td>${contact.email}</td>`;
                html += `<td>${contact.phoneNumber || 'N/A'}</td>`;
                html += `<td>${contact.groups.map(g => `<span class="badge bg-secondary">${g}</span>`).join(' ')}</td>`;
                html += `<td>${getStatusBadge(contact.status)}</td>`;
                html += `<td>
                    <a href="/Contacts/Details/${contact.id}" class="btn btn-sm btn-outline-primary" title="Details">
                        <i class="bi bi-eye"></i>
                    </a>
                    <button class="btn btn-sm btn-outline-success" onclick="editContact(${contact.id})" title="Edit">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteContact(${contact.id})" title="Delete">
                        <i class="bi bi-trash"></i>
                    </button>
                </td>`;
                html += '</tr>';
            });

            html += '</tbody></table></div>';
            listContainer.innerHTML = html;
        }

        function getStatusBadge(status) {
            const statusMap = {
                'Active': 'success',
                'Unsubscribed': 'warning',
                'Bounced': 'danger'
            };
            return `<span class="badge bg-${statusMap[status] || 'secondary'}">${status}</span>`;
        }

        function editContact(id) {
            window.location.href = `/Contacts/Edit/${id}`;
        }

        async function deleteContact(id) {
            if (!confirm('Are you sure you want to delete this contact?')) return;
            alert('Contact deleted! (Demo)');
            loadContacts();
        }

        function importContacts() {
            alert('Import functionality (Demo)');
        }

        function exportContacts() {
            alert('Export functionality (Demo)');
        }
    </script>
}
