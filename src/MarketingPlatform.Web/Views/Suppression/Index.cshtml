@{
    ViewData["Title"] = "Suppression Lists";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-shield-x"></i> Suppression Lists</h2>
        <a href="@Url.Action("Create", "Suppression")" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Create Suppression List
        </a>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" id="searchInput" placeholder="Search suppression lists...">
                    </div>
                </div>
                <div class="col-md-6 text-end">
                    <select class="form-select d-inline-block w-auto" id="typeFilter">
                        <option value="">All Types</option>
                        <option value="OptOut">Opt-Out</option>
                        <option value="Bounced">Bounced</option>
                        <option value="Complained">Complained</option>
                        <option value="Invalid">Invalid</option>
                        <option value="Custom">Custom</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div id="lists-container">
                <div class="text-center py-5">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const apiBaseUrl = '@ViewBag.ApiBaseUrl';
        
        document.addEventListener('DOMContentLoaded', function() {
            loadLists();
            document.getElementById('searchInput').addEventListener('input', loadLists);
            document.getElementById('typeFilter').addEventListener('change', loadLists);
        });

        async function loadLists() {
            const container = document.getElementById('lists-container');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            
            try {
                const mockLists = [
                    { id: 1, name: 'Global Opt-Outs', type: 'OptOut', count: 1247, description: 'All users who have opted out', isActive: true, createdAt: '2024-01-15' },
                    { id: 2, name: 'Hard Bounces', type: 'Bounced', count: 456, description: 'Invalid or non-existent addresses', isActive: true, createdAt: '2024-02-10' },
                    { id: 3, name: 'Spam Complaints', type: 'Complained', count: 89, description: 'Users who marked as spam', isActive: true, createdAt: '2024-02-20' },
                    { id: 4, name: 'Invalid Phone Numbers', type: 'Invalid', count: 234, description: 'Invalid mobile numbers', isActive: true, createdAt: '2024-03-01' },
                    { id: 5, name: 'VIP Exclusions', type: 'Custom', count: 50, description: 'VIP customers excluded from promotions', isActive: false, createdAt: '2024-03-10' }
                ];
                
                let filtered = mockLists;
                
                if (typeFilter) {
                    filtered = filtered.filter(l => l.type === typeFilter);
                }
                
                if (searchTerm) {
                    filtered = filtered.filter(l => 
                        l.name.toLowerCase().includes(searchTerm) ||
                        l.description.toLowerCase().includes(searchTerm)
                    );
                }
                
                renderLists(filtered);
            } catch (error) {
                container.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }

        function renderLists(lists) {
            const container = document.getElementById('lists-container');
            
            if (!lists || lists.length === 0) {
                container.innerHTML = '<div class="alert alert-info"><i class="bi bi-info-circle"></i> No suppression lists found.</div>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table table-hover">';
            html += '<thead><tr><th>Name</th><th>Type</th><th>Entries</th><th>Status</th><th>Created</th><th>Actions</th></tr></thead><tbody>';

            lists.forEach(list => {
                const typeColors = { OptOut: 'danger', Bounced: 'warning', Complained: 'danger', Invalid: 'secondary', Custom: 'info' };
                html += '<tr>';
                html += `<td><strong>${escapeHtml(list.name)}</strong><br/><small class="text-muted">${escapeHtml(list.description)}</small></td>`;
                html += `<td><span class="badge bg-${typeColors[list.type]}">${list.type}</span></td>`;
                html += `<td>${list.count.toLocaleString()}</td>`;
                html += `<td>${list.isActive ? '<span class="badge bg-success">Active</span>' : '<span class="badge bg-secondary">Inactive</span>'}</td>`;
                html += `<td><small>${list.createdAt}</small></td>`;
                html += `<td>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary" onclick="viewEntries(${list.id})" title="View Entries">
                            <i class="bi bi-list-ul"></i>
                        </button>
                        <button class="btn btn-outline-secondary" onclick="editList(${list.id})" title="Edit">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-outline-info" onclick="exportList(${list.id})" title="Export">
                            <i class="bi bi-download"></i>
                        </button>
                        <button class="btn btn-outline-danger" onclick="deleteList(${list.id})" title="Delete">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </td>`;
                html += '</tr>';
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function viewEntries(id) {
            window.location.href = `/Suppression/Entries/${id}`;
        }

        function editList(id) {
            window.location.href = `/Suppression/Edit/${id}`;
        }

        function exportList(id) {
            alert('Exporting suppression list... (Demo)');
        }

        function deleteList(id) {
            if (confirm('Are you sure you want to delete this suppression list?')) {
                alert('Suppression list deleted! (Demo)');
                loadLists();
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
}
