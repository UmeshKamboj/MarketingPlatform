@model MarketingPlatform.Web.Models.AdminDashboardViewModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<!-- Admin Dashboard -->
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3 mb-0"><i class="bi bi-speedometer2 text-primary"></i> Admin Dashboard</h1>
            <p class="text-muted">Manage your marketing platform</p>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-2 text-uppercase small">Total Users</h6>
                            <h2 class="mb-0">@Model.Stats.TotalUsers.ToString("N0")</h2>
                        </div>
                        <div class="text-primary">
                            <i class="bi bi-people fs-1"></i>
                        </div>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-success-subtle text-success"><i class="bi bi-arrow-up"></i> 12%</span>
                        <small class="text-muted ms-1">vs last month</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-2 text-uppercase small">Active Campaigns</h6>
                            <h2 class="mb-0">@Model.Stats.ActiveCampaigns</h2>
                        </div>
                        <div class="text-success">
                            <i class="bi bi-megaphone fs-1"></i>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">Out of @Model.Stats.TotalCampaigns total</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-2 text-uppercase small">Total Revenue</h6>
                            <h2 class="mb-0">$@Model.Stats.TotalRevenue.ToString("N0")</h2>
                        </div>
                        <div class="text-warning">
                            <i class="bi bi-currency-dollar fs-1"></i>
                        </div>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-success-subtle text-success"><i class="bi bi-arrow-up"></i> 8%</span>
                        <small class="text-muted ms-1">vs last month</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-2 text-uppercase small">Delivery Rate</h6>
                            <h2 class="mb-0">@Model.Stats.DeliveryRate.ToString("F1")%</h2>
                        </div>
                        <div class="text-info">
                            <i class="bi bi-check-circle fs-1"></i>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">@Model.Stats.MessagesSentToday.ToString("N0") sent today</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts and Analytics -->
    <div class="row mb-4">
        <div class="col-xl-8 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-graph-up text-primary"></i> Campaign Performance</h5>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-primary active">Week</button>
                            <button type="button" class="btn btn-outline-primary">Month</button>
                            <button type="button" class="btn btn-outline-primary">Year</button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="campaignPerformanceChart" height="80"></canvas>
                </div>
            </div>
        </div>

        <div class="col-xl-4 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0"><i class="bi bi-pie-chart text-primary"></i> Campaign Types</h5>
                </div>
                <div class="card-body">
                    <canvas id="campaignTypesChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity and Campaigns -->
    <div class="row mb-4">
        <div class="col-xl-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0"><i class="bi bi-clock-history text-primary"></i> Recent Activity</h5>
                </div>
                <div class="card-body">
                    <div class="activity-feed">
                        @foreach (var activity in Model.RecentActivities)
                        {
                            <div class="activity-item d-flex mb-3 pb-3 border-bottom">
                                <div class="activity-icon me-3">
                                    <div class="bg-primary-subtle rounded-circle p-2 text-primary">
                                        <i class="@activity.Icon"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">@activity.Title</h6>
                                    <p class="text-muted small mb-1">@activity.Description</p>
                                    <small class="text-muted">@activity.Timestamp.ToString("MMM dd, yyyy HH:mm")</small>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-megaphone text-primary"></i> Recent Campaigns</h5>
                    <a asp-controller="Campaigns" asp-action="Create" class="btn btn-sm btn-primary">
                        <i class="bi bi-plus-circle"></i> New Campaign
                    </a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Success Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var campaign in Model.RecentCampaigns.Take(5))
                                {
                                    var successRate = campaign.Recipients > 0 ? (campaign.SuccessCount * 100.0 / campaign.Recipients) : 0;
                                    <tr>
                                        <td>
                                            <strong>@campaign.Name</strong>
                                            <br />
                                            <small class="text-muted">@campaign.Recipients recipients</small>
                                        </td>
                                        <td>
                                            <span class="badge bg-info-subtle text-info">@campaign.Type</span>
                                        </td>
                                        <td>
                                            @if (campaign.Status == "Active")
                                            {
                                                <span class="badge bg-success">Active</span>
                                            }
                                            else if (campaign.Status == "Scheduled")
                                            {
                                                <span class="badge bg-warning">Scheduled</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary">Completed</span>
                                            }
                                        </td>
                                        <td>
                                            @if (campaign.Recipients > 0)
                                            {
                                                <span>@successRate.ToString("F1")%</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">N/A</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Table -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-people text-primary"></i> User Management</h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="bi bi-download"></i> Export
                        </button>
                        <a asp-controller="Users" asp-action="Create" class="btn btn-sm btn-primary">
                            <i class="bi bi-person-plus"></i> Add User
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <table id="usersTable" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Joined</th>
                                <th>Last Login</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model.RecentUsers)
                            {
                                <tr>
                                    <td>@user.FullName</td>
                                    <td>@user.Email</td>
                                    <td><span class="badge bg-primary-subtle text-primary">@user.Role</span></td>
                                    <td>
                                        @if (user.IsActive)
                                        {
                                            <span class="badge bg-success">Active</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger">Inactive</span>
                                        }
                                    </td>
                                    <td>@user.CreatedAt.ToString("MMM dd, yyyy")</td>
                                    <td>
                                        @if (user.LastLoginAt.HasValue)
                                        {
                                            @user.LastLoginAt.Value.ToString("MMM dd, yyyy")
                                        }
                                        else
                                        {
                                            <span class="text-muted">Never</span>
                                        }
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <button type="button" class="btn btn-outline-primary" title="Edit">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-danger" title="Delete">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="bi bi-megaphone text-primary fs-1 mb-3"></i>
                    <h5>Campaigns</h5>
                    <p class="text-muted small">Manage marketing campaigns</p>
                    <a asp-controller="Campaigns" asp-action="Index" class="btn btn-outline-primary btn-sm">View All</a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="bi bi-graph-up-arrow text-success fs-1 mb-3"></i>
                    <h5>Analytics</h5>
                    <p class="text-muted small">View detailed reports</p>
                    <a asp-controller="Analytics" asp-action="Index" class="btn btn-outline-success btn-sm">View Reports</a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="bi bi-gear text-warning fs-1 mb-3"></i>
                    <h5>Settings</h5>
                    <p class="text-muted small">Platform configuration</p>
                    <a asp-controller="Settings" asp-action="Index" class="btn btn-outline-warning btn-sm">Configure</a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="bi bi-key text-info fs-1 mb-3"></i>
                    <h5>Roles</h5>
                    <p class="text-muted small">Manage permissions</p>
                    <a asp-controller="Roles" asp-action="Index" class="btn btn-outline-info btn-sm">Manage</a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Initialize DataTables
            $('#usersTable').DataTable({
                responsive: true,
                pageLength: 10,
                order: [[4, 'desc']],
                language: {
                    search: "Search users:"
                }
            });

            // Campaign Performance Chart
            const campaignCtx = document.getElementById('campaignPerformanceChart');
            new Chart(campaignCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Sent',
                        data: [1200, 1900, 1500, 2100, 1800, 2400, 2200],
                        borderColor: 'rgb(13, 110, 253)',
                        backgroundColor: 'rgba(13, 110, 253, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Delivered',
                        data: [1150, 1820, 1470, 2050, 1750, 2350, 2170],
                        borderColor: 'rgb(25, 135, 84)',
                        backgroundColor: 'rgba(25, 135, 84, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Campaign Types Chart
            const typesCtx = document.getElementById('campaignTypesChart');
            new Chart(typesCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Email', 'SMS', 'MMS'],
                    datasets: [{
                        data: [65, 25, 10],
                        backgroundColor: [
                            'rgb(13, 110, 253)',
                            'rgb(25, 135, 84)',
                            'rgb(255, 193, 7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        });
    </script>
}
