@{
    ViewData["Title"] = "Tracked URLs";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-link-45deg"></i> Tracked URLs</h2>
        <a href="@Url.Action("Create", "Urls")" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Create Short URL
        </a>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="input-group w-50">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" class="form-control" id="searchInput" placeholder="Search URLs...">
            </div>
        </div>
        <div class="card-body">
            <div id="urls-list">
                <div class="text-center py-5">
                    <div class="spinner-border" role="status"></div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const apiBaseUrl = '@ViewBag.ApiBaseUrl';
        
        document.addEventListener('DOMContentLoaded', function() {
            loadUrls();
            document.getElementById('searchInput').addEventListener('input', loadUrls);
        });

        async function loadUrls() {
            try {
                const mockUrls = [
                    { id: 1, shortCode: 'abc123', originalUrl: 'https://example.com/summer-sale-2024', clicks: 1245, uniqueClicks: 892, campaign: 'Summer Sale', createdAt: '2024-03-15' },
                    { id: 2, shortCode: 'xyz789', originalUrl: 'https://example.com/product-launch', clicks: 2156, uniqueClicks: 1567, campaign: 'Product Launch', createdAt: '2024-03-18' },
                    { id: 3, shortCode: 'def456', originalUrl: 'https://example.com/newsletter-signup', clicks: 567, uniqueClicks: 445, campaign: 'Newsletter', createdAt: '2024-03-20' },
                    { id: 4, shortCode: 'ghi012', originalUrl: 'https://example.com/flash-deals', clicks: 3421, uniqueClicks: 2345, campaign: 'Flash Deals', createdAt: '2024-03-10' }
                ];
                
                renderUrls(mockUrls);
            } catch (error) {
                document.getElementById('urls-list').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }

        function renderUrls(urls) {
            const container = document.getElementById('urls-list');
            
            if (!urls || urls.length === 0) {
                container.innerHTML = '<div class="alert alert-info"><i class="bi bi-info-circle"></i> No URLs found.</div>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table table-hover">';
            html += '<thead><tr><th>Short URL</th><th>Original URL</th><th>Campaign</th><th>Clicks</th><th>Unique</th><th>Created</th><th>Actions</th></tr></thead><tbody>';

            urls.forEach(url => {
                const shortUrl = `${window.location.origin}/s/${url.shortCode}`;
                const clickRate = ((url.uniqueClicks / url.clicks) * 100).toFixed(1);
                
                html += `<tr>
                    <td>
                        <div class="input-group input-group-sm" style="max-width: 300px;">
                            <input type="text" class="form-control" value="${shortUrl}" id="url-${url.id}" readonly>
                            <button class="btn btn-outline-secondary" onclick="copyUrl(${url.id})">
                                <i class="bi bi-clipboard"></i>
                            </button>
                        </div>
                    </td>
                    <td><small class="text-muted">${url.originalUrl.substring(0, 50)}${url.originalUrl.length > 50 ? '...' : ''}</small></td>
                    <td>${url.campaign}</td>
                    <td>${url.clicks.toLocaleString()}</td>
                    <td>${url.uniqueClicks.toLocaleString()}<br><small class="text-muted">${clickRate}%</small></td>
                    <td><small>${url.createdAt}</small></td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewAnalytics(${url.id})" title="Analytics">
                                <i class="bi bi-graph-up"></i>
                            </button>
                            <button class="btn btn-outline-secondary" onclick="editUrl(${url.id})" title="Edit">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteUrl(${url.id})" title="Delete">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>`;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function copyUrl(id) {
            const input = document.getElementById(`url-${id}`);
            input.select();
            document.execCommand('copy');
            alert('URL copied to clipboard!');
        }

        function viewAnalytics(id) {
            window.location.href = `/Urls/Analytics/${id}`;
        }

        function editUrl(id) {
            alert('Edit URL (Demo)');
        }

        function deleteUrl(id) {
            if (confirm('Delete this tracked URL?')) {
                alert('URL deleted! (Demo)');
                loadUrls();
            }
        }
    </script>
}
