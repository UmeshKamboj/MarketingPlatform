@{
    ViewData["Title"] = "Users";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-people"></i> Users</h2>
        <a href="@Url.Action("Create", "Users")" class="btn btn-primary">
            <i class="bi bi-person-plus"></i> Add New User
        </a>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="row">
                <div class="col-md-6">
                    <input type="text" class="form-control" id="searchInput" placeholder="Search users...">
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="roleFilter">
                        <option value="">All Roles</option>
                        <option value="admin">Admin</option>
                        <option value="manager">Manager</option>
                        <option value="user">User</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div id="users-list">
                <div class="text-center py-5">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script nonce="@Context.GetCspNonce()">
        const apiBaseUrl = '@ViewBag.ApiBaseUrl';
        
        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
        });

        async function loadUsers() {
            const listContainer = document.getElementById('users-list');
            
            try {
                const mockUsers = [
                    { id: 1, firstName: 'John', lastName: 'Doe', email: 'john@example.com', role: 'Admin', isActive: true, lastLogin: new Date().toISOString() },
                    { id: 2, firstName: 'Jane', lastName: 'Smith', email: 'jane@example.com', role: 'Manager', isActive: true, lastLogin: new Date(Date.now() - 86400000).toISOString() },
                    { id: 3, firstName: 'Bob', lastName: 'Johnson', email: 'bob@example.com', role: 'User', isActive: false, lastLogin: null }
                ];
                
                renderUsers(mockUsers);
            } catch (error) {
                listContainer.innerHTML = `<div class="alert alert-danger">Error loading users: ${error.message}</div>`;
            }
        }

        function renderUsers(users) {
            const listContainer = document.getElementById('users-list');
            
            if (!users || users.length === 0) {
                listContainer.innerHTML = '<div class="alert alert-info"><i class="bi bi-info-circle"></i> No users found.</div>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table table-hover">';
            html += '<thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Status</th><th>Last Login</th><th>Actions</th></tr></thead><tbody>';

            users.forEach(user => {
                html += '<tr>';
                html += `<td><strong>${user.firstName} ${user.lastName}</strong></td>`;
                html += `<td>${user.email}</td>`;
                html += `<td><span class="badge bg-info">${user.role}</span></td>`;
                html += `<td>${user.isActive ? '<span class="badge bg-success">Active</span>' : '<span class="badge bg-secondary">Inactive</span>'}</td>`;
                html += `<td>${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Never'}</td>`;
                html += `<td>
                    <button class="btn btn-sm btn-outline-primary" onclick="editUser(${user.id})" title="Edit">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteUser(${user.id})" title="Delete">
                        <i class="bi bi-trash"></i>
                    </button>
                </td>`;
                html += '</tr>';
            });

            html += '</tbody></table></div>';
            listContainer.innerHTML = html;
        }

        function editUser(id) {
            window.location.href = `/Users/Edit/${id}`;
        }

        async function deleteUser(id) {
            if (!confirm('Are you sure you want to delete this user?')) return;
            alert('User deleted! (Demo)');
            loadUsers();
        }
    </script>
}
