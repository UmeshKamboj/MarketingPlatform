@model MarketingPlatform.Web.Models.UserDashboardViewModel
@{
    ViewData["Title"] = "My Dashboard";
}

<!-- User Dashboard -->
<div class="container-fluid">
    <!-- Welcome Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body text-white p-4">
                    <h1 class="h2 mb-2">Welcome back, @Model.UserName! ðŸ‘‹</h1>
                    <p class="mb-0 opacity-75">Here's what's happening with your campaigns today.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-xl-2 col-md-4 col-sm-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="bi bi-megaphone text-primary fs-1 mb-2"></i>
                    <h3 class="mb-1">@Model.Stats.TotalCampaigns</h3>
                    <p class="text-muted small mb-0">Total Campaigns</p>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 col-sm-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="bi bi-play-circle text-success fs-1 mb-2"></i>
                    <h3 class="mb-1">@Model.Stats.ActiveCampaigns</h3>
                    <p class="text-muted small mb-0">Active Now</p>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 col-sm-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="bi bi-people text-info fs-1 mb-2"></i>
                    <h3 class="mb-1">@Model.Stats.TotalContacts.ToString("N0")</h3>
                    <p class="text-muted small mb-0">Total Contacts</p>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 col-sm-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="bi bi-envelope text-warning fs-1 mb-2"></i>
                    <h3 class="mb-1">@Model.Stats.MessagesSent.ToString("N0")</h3>
                    <p class="text-muted small mb-0">Messages Sent</p>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-md-8 col-sm-12 mb-3">
            <div class="card border-0 shadow-sm h-100 bg-success text-white">
                <div class="card-body text-center">
                    <i class="bi bi-graph-up-arrow fs-1 mb-2"></i>
                    <h3 class="mb-1">@Model.Stats.EngagementRate.ToString("F1")%</h3>
                    <p class="small mb-0 opacity-75">Engagement Rate</p>
                    <span class="badge bg-white text-success mt-2">
                        <i class="bi bi-arrow-up"></i> +5.2% vs last week
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-3"><i class="bi bi-lightning-fill text-warning"></i> Quick Actions</h5>
                    <div class="d-flex flex-wrap gap-2">
                        <a asp-controller="Campaigns" asp-action="Create" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Create Campaign
                        </a>
                        <a asp-controller="Contacts" asp-action="Create" class="btn btn-outline-primary">
                            <i class="bi bi-person-plus"></i> Add Contact
                        </a>
                        <a asp-controller="Templates" asp-action="Create" class="btn btn-outline-primary">
                            <i class="bi bi-file-earmark-text"></i> New Template
                        </a>
                        <a asp-controller="Analytics" asp-action="Index" class="btn btn-outline-secondary">
                            <i class="bi bi-graph-up"></i> View Analytics
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- My Campaigns and Analytics -->
    <div class="row mb-4">
        <div class="col-xl-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-megaphone text-primary"></i> My Campaigns</h5>
                    <a asp-controller="Campaigns" asp-action="Index" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body">
                    @if (Model.MyCampaigns.Any())
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var campaign in Model.MyCampaigns)
                            {
                                var successRate = campaign.Recipients > 0 ? (campaign.SuccessCount * 100.0 / campaign.Recipients) : 0;
                                <div class="list-group-item px-0">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h6 class="mb-1">@campaign.Name</h6>
                                            <div class="d-flex gap-2 mb-2">
                                                <span class="badge bg-info-subtle text-info">@campaign.Type</span>
                                                @if (campaign.Status == "Active")
                                                {
                                                    <span class="badge bg-success">Active</span>
                                                }
                                                else if (campaign.Status == "Scheduled")
                                                {
                                                    <span class="badge bg-warning">Scheduled</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">Completed</span>
                                                }
                                            </div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </div>
                                    <div class="d-flex justify-content-between text-muted small">
                                        <span><i class="bi bi-people"></i> @campaign.Recipients recipients</span>
                                        @if (campaign.Recipients > 0)
                                        {
                                            <span><i class="bi bi-check-circle"></i> @successRate.ToString("F1")% success</span>
                                        }
                                    </div>
                                    @if (campaign.Status == "Active" || campaign.Status == "Completed")
                                    {
                                        <div class="progress mt-2" style="height: 5px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: @successRate.ToString("F1")%"></div>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-inbox fs-1 mb-2"></i>
                            <p>No campaigns yet. Create your first campaign!</p>
                            <a asp-controller="Campaigns" asp-action="Create" class="btn btn-primary">
                                <i class="bi bi-plus-circle"></i> Create Campaign
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-xl-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0"><i class="bi bi-graph-up text-primary"></i> Message Activity</h5>
                </div>
                <div class="card-body">
                    <canvas id="monthlyMessagesChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity and Campaign Performance -->
    <div class="row mb-4">
        <div class="col-xl-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0"><i class="bi bi-clock-history text-primary"></i> Recent Activity</h5>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        @foreach (var activity in Model.RecentActivities)
                        {
                            <div class="timeline-item mb-3 pb-3 border-bottom">
                                <div class="d-flex">
                                    <div class="timeline-icon me-3">
                                        <div class="bg-primary-subtle rounded-circle p-2 text-primary">
                                            <i class="@activity.Icon"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">@activity.Title</h6>
                                        <p class="text-muted small mb-1">@activity.Description</p>
                                        <small class="text-muted">
                                            <i class="bi bi-clock"></i> @activity.Timestamp.ToString("MMM dd, yyyy HH:mm")
                                        </small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0"><i class="bi bi-trophy text-primary"></i> Top Performing Campaigns</h5>
                </div>
                <div class="card-body">
                    @if (Model.Analytics.TopCampaigns.Any())
                    {
                        @foreach (var campaign in Model.Analytics.TopCampaigns)
                        {
                            <div class="mb-4">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="fw-medium">@campaign.CampaignName</span>
                                    <span class="text-muted small">@campaign.TotalSent sent</span>
                                </div>
                                <div class="progress" style="height: 25px;">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                         style="width: @campaign.SuccessRate.ToString("F1")%"
                                         aria-valuenow="@campaign.SuccessRate" aria-valuemin="0" aria-valuemax="100">
                                        @campaign.SuccessRate.ToString("F1")%
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-bar-chart fs-1 mb-2"></i>
                            <p>No campaign data available yet.</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Section -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5 class="card-title mb-2"><i class="bi bi-person-circle text-primary"></i> Profile & Settings</h5>
                            <p class="text-muted mb-0">Manage your account settings and preferences</p>
                        </div>
                        <div class="col-md-4 text-md-end mt-3 mt-md-0">
                            <a asp-controller="Users" asp-action="Profile" class="btn btn-outline-primary me-2">
                                <i class="bi bi-person"></i> View Profile
                            </a>
                            <a asp-controller="Users" asp-action="Settings" class="btn btn-primary">
                                <i class="bi bi-gear"></i> Settings
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Monthly Messages Chart
            const monthlyCtx = document.getElementById('monthlyMessagesChart');
            new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: [@string.Join(",", Model.Analytics.MonthlyMessages.Select(m => $"'{m.Month}'"))],
                    datasets: [{
                        label: 'Messages Sent',
                        data: [@string.Join(",", Model.Analytics.MonthlyMessages.Select(m => m.Count))],
                        backgroundColor: 'rgba(13, 110, 253, 0.7)',
                        borderColor: 'rgb(13, 110, 253)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>
}
